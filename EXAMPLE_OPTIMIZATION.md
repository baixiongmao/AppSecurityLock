# 示例应用开关优化说明

## 优化内容

### 1. 开关逻辑改进

#### 主安全锁开关
- **标题**: 启用安全锁
- **功能**: 主控制开关，控制所有安全功能
- **逻辑**: 
  - 关闭时会自动关闭所有子功能
  - 开启时允许配置子功能
  - 带有视觉指示器（绿色锁图标）

#### 面容ID/指纹开关
- **标题**: 启用面容ID/指纹
- **功能**: 控制生物识别认证
- **逻辑**: 
  - 仅在主安全锁开启且设备支持生物识别时可用
  - 显示设备支持的生物识别类型
  - 不支持时显示相应提示

#### 密码解锁开关
- **标题**: 启用密码解锁
- **功能**: 使用设备密码作为备选认证方案
- **逻辑**: 
  - 仅在主安全锁开启时可用
  - 默认开启，作为可靠的备选方案

#### 屏幕锁定检测开关
- **标题**: 屏幕锁定检测
- **功能**: 检测屏幕亮度为0时自动锁定应用
- **逻辑**: 
  - 仅在主安全锁开启时可用
  - 适用于支持屏幕锁定功能的设备

#### 后台超时锁定开关
- **标题**: 后台超时锁定
- **功能**: 应用进入后台后经过设定时间自动锁定
- **逻辑**: 
  - 仅在主安全锁开启时可用
  - 配合后台超时时间滑块使用

### 2. 后台超时时间滑块

- **范围**: 30秒 - 5分钟
- **步进**: 9个档位
- **逻辑**: 
  - 仅在主安全锁和后台超时锁定都开启时可用
  - 实时显示当前设置的时间
  - 支持即时应用设置

### 3. 视觉改进

#### 卡片样式
- 主安全锁开启时：正常颜色
- 主安全锁关闭时：灰色背景，表示功能不可用

#### 图标指示
- 安全锁开启：绿色实心锁图标
- 安全锁关闭：灰色轮廓锁图标

#### 子标题说明
- 每个开关都有详细的功能说明
- 生物识别开关显示设备支持的具体类型

### 4. 交互逻辑优化

#### 自动重新初始化
- 任何设置更改后自动重新初始化插件
- 确保配置立即生效
- 错误处理，防止初始化失败影响用户体验

#### 级联控制
- 主开关关闭时自动关闭所有子功能
- 避免用户产生困惑
- 保持界面状态的一致性

#### 条件启用
- 根据前置条件动态启用/禁用开关
- 提供清晰的视觉反馈
- 防止无效操作

## 使用流程

### 首次使用
1. 应用启动时，主安全锁默认开启
2. 密码解锁默认开启，作为基础认证方案
3. 用户可根据需要开启生物识别
4. 根据使用场景配置屏幕锁定和后台超时

### 日常使用
1. 通过主安全锁快速开启/关闭所有安全功能
2. 单独调整各项安全设置
3. 根据需要调整后台超时时间
4. 所有更改立即生效，无需手动保存

## 技术实现

### 状态管理
```dart
// 默认配置
bool _isLockEnabled = true;           // 主开关默认开启
bool _isPasscodeEnabled = true;       // 密码解锁默认开启
bool _isFaceIDEnabled = false;        // 生物识别需用户主动开启
bool _isScreenLockEnabled = false;    // 屏幕锁定需用户主动开启
bool _isBackgroundLockEnabled = false; // 后台锁定需用户主动开启
double _backgroundTimeout = 60.0;     // 默认1分钟超时
```

### 重新初始化机制
```dart
Future<void> reinitializePlugin() async {
  try {
    await _appSecurityLockPlugin.init(
      isFaceIDEnabled: _isFaceIDEnabled,
      isPasscodeEnabled: _isPasscodeEnabled,
      isScreenLockEnabled: _isScreenLockEnabled,
      isBackgroundLockEnabled: _isBackgroundLockEnabled,
      backgroundTimeout: _backgroundTimeout,
    );
  } catch (e) {
    print('重新初始化插件失败: $e');
  }
}
```

这种优化确保了用户界面的直观性、功能的可靠性和配置的即时生效。
